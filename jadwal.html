<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jadwal Pelajaran XTM1</title>
    <link rel="stylesheet" href="assets/css/jadwal.css">
    <link rel="icon" type="image/png" href="assets/img/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="assets/img/favicon.svg" />
    <link rel="shortcut icon" href="assets/img/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="assets/img/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="Xmeka1" />
    <link rel="manifest" href="assets/img/site.webmanifest" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="dark-mode">
    <!-- Background Elements -->
    <div class="bg-elements">
        <div class="bg-circle circle-1"></div>
        <div class="bg-circle circle-2"></div>
        <div class="bg-circle circle-3"></div>
        <div class="bg-circle circle-4"></div>
        <div class="stars"></div>
        <div class="stars stars-2"></div>
    </div>

    <!-- Music Control -->
    <div class="music-control">
        <button id="musicToggle" class="music-btn">
            <i class="fas fa-music"></i>
        </button>
        <audio id="bgMusic" loop preload="none">
            <source src="assets/music/bgm3.mp3" type="audio/mpeg">
            <source src="assets/audio/background-music.ogg" type="audio/ogg">
        </audio>
    </div>

    <!-- Theme Toggle -->
    <div class="theme-toggle">
        <button id="themeToggle" class="theme-btn">
            <i class="fas fa-moon"></i>
        </button>
    </div>

    <!-- Robot Maskot -->
    <div class="robot-container">
        <div class="robot" id="robot">
            <div class="robot-head">
                <div class="robot-eye left-eye"></div>
                <div class="robot-eye right-eye"></div>
                <div class="robot-mouth"></div>
            </div>
            <div class="robot-body">
                <div class="robot-panel"></div>
            </div>
        </div>
        <div class="robot-speech-bubble" id="robotSpeech">
            Halo! Ini jadwal pelajaran XTM1!
        </div>
    </div>

    <!-- Navbar -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <h2>XTM<span class="logo-highlight">1</span></h2>
            </div>
            <div class="nav-menu" id="navMenu">
                <a href="index.html" class="nav-link">Beranda</a>
                <a href="index.html#about" class="nav-link">Tentang</a>
                <a href="index.html#gallery" class="nav-link">Galeri</a>
                <a href="anggota.html" class="nav-link">Anggota</a>
                <a href="dokxtm1.html" class="nav-link">Dokumentasi</a>
                <a href="jadwal.html" class="nav-link active">Jadwal</a>
            </div>
            <div class="hamburger" id="hamburger">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
        </div>
    </nav>

    <!-- Schedule Section -->
    <section class="schedule-section">
        <div class="container">
            <div class="schedule-header fade-in">
                <h1>Jadwal <span class="logo-highlight">Pelajaran</span></h1>
                <h2>XTM1 Mekatronika</h2>
                <p class="tagline">Semester Genap 2025/2026</p>
            </div>

            <!-- Current Day Info -->
            <div class="current-day-info fade-in">
                <div class="day-card today">
                    <div class="day-icon">
                        <i class="fas fa-calendar-day"></i>
                    </div>
                    <div class="day-info">
                        <h3 id="currentDay">Hari Ini</h3>
                        <p id="currentDate">Loading...</p>
                        <div class="today-badge">HARI INI</div>
                    </div>
                </div>
                <div class="schedule-stats">
                    <div class="stat">
                        <div class="stat-number" id="totalSubjects">0</div>
                        <div class="stat-label">Mata Pelajaran</div>
                    </div>
                    <div class="stat">
                        <div class="stat-number" id="totalHours">0</div>
                        <div class="stat-label">Jam Pelajaran</div>
                    </div>
                </div>
            </div>

            <!-- Schedule Navigation -->
            <div class="schedule-navigation fade-in">
                <div class="day-filters">
                    <button class="day-filter active" data-day="all">Semua Hari</button>
                    <button class="day-filter" data-day="senin">Senin</button>
                    <button class="day-filter" data-day="selasa">Selasa</button>
                    <button class="day-filter" data-day="rabu">Rabu</button>
                    <button class="day-filter" data-day="kamis">Kamis</button>
                    <button class="day-filter" data-day="jumat">Jumat</button>
                </div>
                <div class="view-options">
                    <button class="view-option active" data-view="grid">
                        <i class="fas fa-th"></i>
                    </button>
                    <button class="view-option" data-view="list">
                        <i class="fas fa-list"></i>
                    </button>
                </div>
            </div>

            <!-- Schedule Container -->
            <div class="schedule-container" id="scheduleContainer">
                <div class="loading">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Memuat jadwal dari database...</p>
                </div>
            </div>

            <!-- Weekly Summary -->
            <div class="weekly-summary fade-in">
                <h3>Ringkasan Mingguan</h3>
                <div class="summary-grid">
                    <div class="summary-card">
                        <div class="summary-icon">
                            <i class="fas fa-book-open"></i>
                        </div>
                        <div class="summary-content">
                            <h4 id="totalSubjectsSummary">0</h4>
                            <p>Mata Pelajaran</p>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="summary-content">
                            <h4 id="totalHoursSummary">0</h4>
                            <p>Jam Pelajaran</p>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon">
                            <i class="fas fa-user-graduate"></i>
                        </div>
                        <div class="summary-content">
                            <h4 id="totalTeachers">0</h4>
                            <p>Guru Pengajar</p>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon">
                            <i class="fas fa-flask"></i>
                        </div>
                        <div class="summary-content">
                            <h4 id="totalLabs">0</h4>
                            <p>Laboratorium</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <h2>XTM<span class="logo-highlight">1</span> SPACE</h2>
                    <p>Teknologi, Kreativitas, dan Solidaritas</p>
                </div>
                <div class="footer-links">
                    <h3>Tautan Cepat</h3>
                    <ul>
                        <li><a href="index.html">Beranda</a></li>
                        <li><a href="anggota.html">Anggota</a></li>
                        <li><a href="jadwal.html">Jadwal</a></li>
                        <li><a href="dokxtm1.html">Dokumentasi</a></li>
                    </ul>
                </div>
                <div class="footer-social">
                    <h3>Ikuti Kami</h3>
                    <div class="social-icons">
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-youtube"></i></a>
                        <a href="#"><i class="fab fa-tiktok"></i></a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 XTM1 Mekatronika | SMK Texar Karawang</p>
            </div>
        </div>
    </footer>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js"></script>

    <script src="assets/js/jadwal.js"></script>
    
    <!-- Firebase Integration -->
    <script>
        // Firebase Configuration - GANTI INI DENGAN CONFIG-MU!
        const firebaseConfig = {
            apiKey: "AIzaSyDlv1vOjzQyUM7yY89Cb40o79PIT6AiuYc",
            authDomain: "xtm1-79048.firebaseapp.com",
            databaseURL: "https://xtm1-79048-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "xtm1-79048",
            storageBucket: "xtm1-79048.firebasestorage.app",
            messagingSenderId: "36588922230",
            appId: "1:36588922230:web:28ed2d2dc9f58ec9f6c657"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        // Load jadwal dari Firebase
        function loadJadwalFromFirebase() {
            const db = firebase.database();
            const container = document.getElementById('scheduleContainer');
            
            db.ref('jadwal').on('value', (snapshot) => {
                const jadwal = snapshot.val();
                
                if (!jadwal) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-calendar-times"></i>
                            <h3>Jadwal Belum Tersedia</h3>
                            <p>Admin belum mengisi jadwal. Silakan hubungi admin.</p>
                        </div>
                    `;
                    return;
                }

                displayJadwal(jadwal);
                updateStatistics(jadwal);
                
            }, (error) => {
                console.error('Error:', error);
                container.innerHTML = `
                    <div class="error-state">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3>Gagal Memuat Jadwal</h3>
                        <p>Error: ${error.message}</p>
                        <button onclick="loadJadwalFromFirebase()" class="btn-retry">
                            <i class="fas fa-redo"></i> Coba Lagi
                        </button>
                    </div>
                `;
            });
        }

        function displayJadwal(jadwal) {
            const container = document.getElementById('scheduleContainer');
            let html = '';
            
            const days = ['senin', 'selasa', 'rabu', 'kamis', 'jumat'];
            const dayNames = {
                'senin': 'Senin',
                'selasa': 'Selasa', 
                'rabu': 'Rabu',
                'kamis': 'Kamis',
                'jumat': 'Jumat'
            };

            days.forEach(day => {
                if (jadwal[day] && jadwal[day].length > 0) {
                    html += `
                        <div class="day-schedule active" id="${day}">
                            <div class="day-header">
                                <h3>${dayNames[day]}</h3>
                                <span class="lesson-count">${jadwal[day].length} Pelajaran</span>
                            </div>
                            <div class="lessons-grid">
                                ${jadwal[day].map(lesson => `
                                    <div class="lesson-card">
                                        <div class="lesson-time">
                                            <span class="time-start">${lesson.waktu || ''}</span>
                                        </div>
                                        <div class="lesson-content">
                                            <h4 class="lesson-name">${lesson.matkul || ''}</h4>
                                            <p class="lesson-teacher">${lesson.dosen || '-'}</p>
                                            <div class="lesson-meta">
                                                <span class="lesson-room">
                                                    <i class="fas fa-map-marker-alt"></i> ${lesson.ruang || ''}
                                                </span>
                                            </div>
                                        </div>
                                        <div class="lesson-icon">
                                            <i class="fas fa-book"></i>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }
            });

            container.innerHTML = html || `
                <div class="empty-state">
                    <i class="fas fa-calendar-times"></i>
                    <h3>Jadwal Kosong</h3>
                    <p>Tidak ada jadwal untuk ditampilkan</p>
                </div>
            `;

            setupDayFilters();
        }

        function updateStatistics(jadwal) {
            let totalSubjects = 0;
            let uniqueTeachers = new Set();
            let uniqueRooms = new Set();

            Object.values(jadwal).forEach(dayLessons => {
                if (dayLessons) {
                    totalSubjects += dayLessons.length;
                    dayLessons.forEach(lesson => {
                        if (lesson.dosen) uniqueTeachers.add(lesson.dosen);
                        if (lesson.ruang && lesson.ruang.toLowerCase().includes('lab')) {
                            uniqueRooms.add(lesson.ruang);
                        }
                    });
                }
            });

            document.getElementById('totalSubjects').textContent = totalSubjects;
            document.getElementById('totalHours').textContent = totalSubjects;
            document.getElementById('totalSubjectsSummary').textContent = totalSubjects;
            document.getElementById('totalHoursSummary').textContent = totalSubjects;
            document.getElementById('totalTeachers').textContent = uniqueTeachers.size;
            document.getElementById('totalLabs').textContent = uniqueRooms.size;
        }

        function setupDayFilters() {
            document.querySelectorAll('.day-filter').forEach(button => {
                button.addEventListener('click', (e) => {
                    const day = e.target.dataset.day;
                    
                    document.querySelectorAll('.day-filter').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    e.target.classList.add('active');
                    
                    const allSchedules = document.querySelectorAll('.day-schedule');
                    
                    if (day === 'all') {
                        allSchedules.forEach(schedule => schedule.classList.add('active'));
                    } else {
                        allSchedules.forEach(schedule => {
                            schedule.classList.remove('active');
                            if (schedule.id === day) {
                                schedule.classList.add('active');
                            }
                        });
                    }
                });
            });
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadJadwalFromFirebase();
            
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('currentDate').textContent = now.toLocaleDateString('id-ID', options);
        });
    </script>
</body>
</html>
